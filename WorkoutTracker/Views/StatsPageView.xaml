<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkoutTracker.ViewModels"
             xmlns:models="clr-namespace:WorkoutTracker.Models"
             xmlns:converters="clr-namespace:WorkoutTracker.Converters"
             x:Class="WorkoutTracker.Views.StatsPageView"
             x:DataType="vm:StatsViewModel"
             Title="Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°">

    <ContentPage.Resources>
        <converters:IsNotNullConverter x:Key="IsNotNullConverter" />

        <DataTemplate x:Key="WorkoutItemTemplate" x:DataType="models:WorkoutHistory">
            <Border Style="{StaticResource CardStyle}" Padding="15">
                <Grid ColumnDefinitions="*, Auto">
                    <VerticalStackLayout Spacing="4">
                        <Label Text="{Binding WorkoutName}" Style="{StaticResource LabelBody}" FontAttributes="Bold"/>
                        <Label Text="{Binding WorkoutDetails}" Style="{StaticResource LabelCaption}"/>
                    </VerticalStackLayout>
                    <Label Grid.Column="1" Text="{Binding WorkoutDate, StringFormat='{0:HH:mm}'}" 
                           TextColor="{StaticResource AccentMain}" FontAttributes="Bold" VerticalOptions="Center"/>
                </Grid>
            </Border>
        </DataTemplate>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, Auto, *, Auto">
        
        <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto" Padding="15" BackgroundColor="{StaticResource BackgroundCard}">
            <Button Grid.Column="0" Text="â—€" TextColor="{StaticResource TextPrimary}" BackgroundColor="Transparent" BorderColor="Transparent" Command="{Binding PreviousMonthCommand}"/>
            <Label Grid.Column="1" Text="{Binding CurrentMonthName}" Style="{StaticResource LabelTitle}" FontSize="18" HorizontalOptions="Center" VerticalOptions="Center"/>
            <Button Grid.Column="2" Text="â–¶" TextColor="{StaticResource TextPrimary}" BackgroundColor="Transparent" BorderColor="Transparent" Command="{Binding NextMonthCommand}"/>
        </Grid>

        <Border Grid.Row="1" Margin="20" StrokeShape="RoundRectangle 20" BackgroundColor="{StaticResource BackgroundCard}" StrokeThickness="0" Padding="10">
            <VerticalStackLayout>
                <Grid ColumnDefinitions="*,*,*,*,*,*,*">
                    <Label Text="ÐŸÐ" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                    <Label Grid.Column="1" Text="Ð’Ð¢" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                    <Label Grid.Column="2" Text="Ð¡Ð " Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                    <Label Grid.Column="3" Text="Ð§Ð¢" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                    <Label Grid.Column="4" Text="ÐŸÐ¢" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                    <Label Grid.Column="5" Text="Ð¡Ð‘" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                    <Label Grid.Column="6" Text="Ð’Ð¡" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                </Grid>

                <Grid x:Name="CalendarGrid" 
                      ColumnDefinitions="*,*,*,*,*,*,*" 
                      RowDefinitions="50,50,50,50,50,50"
                      RowSpacing="5" ColumnSpacing="5" Margin="0,10,0,0">
                </Grid>
            </VerticalStackLayout>
        </Border>

        <Grid Grid.Row="2" RowDefinitions="Auto, *" IsVisible="{Binding SelectedDate, Converter={StaticResource IsNotNullConverter}}">
            <Label Grid.Row="0" 
                    Text="{Binding SelectedDate, StringFormat='{0:dd MMMM}'}" 
                    Style="{StaticResource LabelTitle}" 
                    Margin="20,0,0,10"/>

            <CollectionView Grid.Row="1" 
                            ItemsSource="{Binding WorkoutsForSelectedDate}"
                            ItemTemplate="{StaticResource WorkoutItemTemplate}"
                            Margin="20,0">
                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="10">
                        <Label Text="ðŸ“…" FontSize="40" HorizontalOptions="Center"/>
                        <Label Text="ÐÐµÑ‚ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð¾Ðº" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>


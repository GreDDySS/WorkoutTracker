<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkoutTracker.ViewModels"
             xmlns:models="clr-namespace:WorkoutTracker.Models"
             xmlns:converters="clr-namespace:WorkoutTracker.Converters"
             x:Class="WorkoutTracker.Views.StatsPageView"
             x:DataType="vm:StatsViewModel"
             Title="Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°"
             BackgroundColor="#121212">

    <ContentPage.Resources>
        <converters:IsNotNullConverter x:Key="IsNotNullConverter" />

        <DataTemplate x:Key="WorkoutItemTemplate" x:DataType="models:WorkoutHistory">
            <Frame Style="{StaticResource FrameCard}"
                   Margin="0,5,0,5">
                <VerticalStackLayout Spacing="{StaticResource SpacingXSmall}">
                    
                    <Label Text="{Binding WorkoutName}" 
                           Style="{StaticResource LabelBody}" 
                           FontAttributes="Bold"/>
                    <Label Text="{Binding WorkoutDetails}" 
                           Style="{StaticResource LabelSubtle}"/>
                    <Label Text="{Binding WorkoutDate, StringFormat='{0:HH:mm}'}" 
                           TextColor="{StaticResource AccentPrimary}"  
                           FontSize="{StaticResource FontSizeCaption}"/>
                    
                </VerticalStackLayout>
            </Frame>
        </DataTemplate>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, Auto, *, Auto">
        <Grid Grid.Row="0" 
              BackgroundColor="{StaticResource BackgroundCard}" 
              Padding="15,10"
              ColumnDefinitions="50, *, 50">

            <Button Grid.Column="0"
                    Text="â—€"
                    FontSize="20"
                    BackgroundColor="{StaticResource TransparentColor}"
                    BorderColor="{StaticResource TransparentColor}"
                    TextColor="{StaticResource TextPrimary}"
                    Command="{Binding PreviousMonthCommand}"
                    WidthRequest="50"
                    HeightRequest="50"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"/>

            <Label Grid.Column="1"
                   Text="{Binding CurrentMonthName}"
                   Style="{StaticResource LabelBody}"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"/>

            <Button Grid.Column="2"
                    Text="â–¶"
                    FontSize="20"
                    BackgroundColor="{StaticResource TransparentColor}"
                    BorderColor="{StaticResource TransparentColor}"
                    TextColor="{StaticResource TextPrimary}"
                    Command="{Binding NextMonthCommand}"
                    WidthRequest="50"
                    HeightRequest="50"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"/>
        </Grid>

        <ScrollView Grid.Row="2" Padding="10">
            <VerticalStackLayout Spacing="{StaticResource SpacingSmall}" HorizontalOptions="Center">
                <Grid ColumnDefinitions="50,50,50,50,50,50,50" 
                      ColumnSpacing="3"
                      HeightRequest="30"
                      Margin="0,0,0,5">
                    <Label Grid.Column="0" Text="ÐŸÐ" TextColor="{StaticResource TextTertiary}" FontSize="{StaticResource FontSizeCaption}" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Label Grid.Column="1" Text="Ð’Ð¢" TextColor="{StaticResource TextTertiary}" FontSize="{StaticResource FontSizeCaption}" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Label Grid.Column="2" Text="Ð¡Ð " TextColor="{StaticResource TextTertiary}" FontSize="{StaticResource FontSizeCaption}" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Label Grid.Column="3" Text="Ð§Ð¢" TextColor="{StaticResource TextTertiary}" FontSize="{StaticResource FontSizeCaption}" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Label Grid.Column="4" Text="ÐŸÐ¢" TextColor="{StaticResource TextTertiary}" FontSize="{StaticResource FontSizeCaption}" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Label Grid.Column="5" Text="Ð¡Ð‘" TextColor="{StaticResource TextTertiary}" FontSize="{StaticResource FontSizeCaption}" HorizontalOptions="Center" VerticalOptions="Center"/>
                    <Label Grid.Column="6" Text="Ð’Ð¡" TextColor="{StaticResource TextTertiary}" FontSize="{StaticResource FontSizeCaption}" HorizontalOptions="Center" VerticalOptions="Center"/>
                </Grid>

                <Grid x:Name="CalendarGrid" 
                      ColumnDefinitions="50,50,50,50,50,50,50" 
                      RowDefinitions="50,50,50,50,50,50"
                      ColumnSpacing="3"
                      RowSpacing="3"
                      BackgroundColor="{StaticResource BackgroundSecondary}">
                </Grid>
            </VerticalStackLayout>
        </ScrollView>

        <Grid Grid.Row="3" 
              RowDefinitions="Auto, *"
              BackgroundColor="{StaticResource BackgroundSecondary}"
              IsVisible="{Binding SelectedDate, Converter={StaticResource IsNotNullConverter}}"
              MaximumHeightRequest="280">

            <Frame Grid.Row="0"
                   Style="{StaticResource FrameHeader}"
                   Margin="15,10,15,5"
                   HasShadow="False">
                <Label Text="{Binding SelectedDate, StringFormat='Ð¢Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²ÐºÐ¸ Ð·Ð° {0:dd MMMM yyyy}'}"
                       Style="{StaticResource LabelCaption}"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </Frame>

            <CollectionView Grid.Row="1"
                           ItemsSource="{Binding WorkoutsForSelectedDate}"
                           ItemTemplate="{StaticResource WorkoutItemTemplate}"
                           SelectionMode="None"
                           Margin="15,0,15,10"
                           BackgroundColor="{StaticResource TransparentColor}">
                
                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center" 
                                       VerticalOptions="Center"
                                       Spacing="{StaticResource SpacingSmall}"
                                       Padding="{StaticResource SpacingLarge}">
                        <Label Text="ðŸ“…"
                               FontSize="40"
                               HorizontalOptions="Center"/>
                        <Label Text="ÐÐµÑ‚ Ñ‚Ñ€ÐµÐ½Ð¸Ñ€Ð¾Ð²Ð¾Ðº Ð² ÑÑ‚Ð¾Ñ‚ Ð´ÐµÐ½ÑŒ"
                               Style="{StaticResource LabelCaption}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </Grid>
    </Grid>
</ContentPage>


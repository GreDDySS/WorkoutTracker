<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkoutTracker.ViewModels"
             xmlns:models="clr-namespace:WorkoutTracker.Models"
             x:Class="WorkoutTracker.Views.SelectExercisesPageView"
             x:DataType="vm:SelectExercisesViewModel"
             Title="Выбрать упражнения"
             Shell.NavBarIsVisible="False">

    <ContentPage.Resources>
        <DataTemplate x:Key="ExerciseSelectTemplate" x:DataType="models:SelectableExercise">
            <Frame Style="{StaticResource FrameCard}"
                   Margin="0,5,0,5">
                <Grid ColumnDefinitions="Auto, *">
                    <CheckBox Grid.Column="0"
                              IsChecked="{Binding IsSelected}"
                              VerticalOptions="Center"
                              Margin="0,0,15,0"/>
                    <VerticalStackLayout Grid.Column="1" 
                                         Spacing="3">
                        <Label Text="{Binding Name}"
                               Style="{StaticResource LabelBody}"
                               FontAttributes="Bold"/>
                        <Label Text="{Binding Details}"
                               Style="{StaticResource LabelSubtle}"/>
                    </VerticalStackLayout>
                </Grid>
            </Frame>
        </DataTemplate>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, *, Auto" RowSpacing="0">

        <Grid Grid.Row="0" 
              ColumnDefinitions="Auto, *, Auto" 
              Padding="15,15,15,20"
              BackgroundColor="{StaticResource BackgroundTertiary}">

            <Button Grid.Column="0"
                    Command="{Binding CloseCommand}"
                    Style="{StaticResource ButtonClose}"/>

            <VerticalStackLayout Grid.Column="1"
                                 HorizontalOptions="Center"
                                 Spacing="{StaticResource SpacingXSmall}">
                <Label Text="ВЫБРАТЬ УПРАЖНЕНИЯ"
                       Style="{StaticResource LabelBody}"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <BoxView Grid.Column="2"
                     WidthRequest="40"
                     HeightRequest="40"
                     Color="{StaticResource TransparentColor}"/>
        </Grid>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="{StaticResource SpacingLarge}" Spacing="{StaticResource SpacingMedium}">

                <VerticalStackLayout Spacing="10">
                    <Label Text="СВОИ"
                           Style="{StaticResource LabelBody}"
                           FontAttributes="Bold"
                           Margin="0,0,0,5"/>

                    <CollectionView ItemsSource="{Binding CustomExercises}"
                                    ItemTemplate="{StaticResource ExerciseSelectTemplate}"
                                    SelectionMode="None"/>

                    <VerticalStackLayout IsVisible="{Binding HasNoCustomExercises}"
                                         VerticalOptions="Center"
                                         HorizontalOptions="Center"
                                         Spacing="{StaticResource SpacingXSmall}"
                                         Margin="0,10">
                        
                        <Label Text="Нет своих упражнений"
                               Style="{StaticResource LabelCaption}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="{StaticResource SpacingSmall}">
                    <Label Text="СИСТЕМНЫЕ"
                           Style="{StaticResource LabelBody}"
                           FontAttributes="Bold"
                           Margin="0,10,0,5"/>

                    <CollectionView ItemsSource="{Binding SystemExercises}"
                                    ItemTemplate="{StaticResource ExerciseSelectTemplate}"
                                    SelectionMode="None"/>

                    <VerticalStackLayout IsVisible="{Binding HasNoSystemExercises}"
                                         VerticalOptions="Center"
                                         HorizontalOptions="Center"
                                         Spacing="{StaticResource SpacingXSmall}"
                                         Margin="0,10">
                        <Label Text="Нет системных упражнений"
                               Style="{StaticResource LabelCaption}"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <Grid Grid.Row="2"
              Padding="15,20,15,30">
            <Button Command="{Binding AddSelectedCommand}"
                    Text="{Binding AddButtonText}"
                    Style="{StaticResource ButtonPrimary}"
                    IsEnabled="{Binding HasSelectedExercises}"/>
        </Grid>
    </Grid>
</ContentPage>
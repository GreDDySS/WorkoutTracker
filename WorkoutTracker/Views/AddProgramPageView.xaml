<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkoutTracker.ViewModels"
             xmlns:models="clr-namespace:WorkoutTracker.Models"
             x:Class="WorkoutTracker.Views.AddProgramPageView"
             x:DataType="vm:AddProgramViewModel"
             Title="Добавить программу">
    
    <ContentPage.Resources>
        <DataTemplate x:Key="ProgramExerciseTemplate" x:DataType="models:ProgramExerciseItem">
            <Frame BackgroundColor="{StaticResource BackgroundElevated}"
                   CornerRadius="{StaticResource RadiusSmall}"
                   Padding="{StaticResource SpacingMedium}"
                   Margin="0,5,0,5"
                   HasShadow="False">
                
                <Grid ColumnDefinitions="*, Auto, Auto">
                    <VerticalStackLayout Grid.Column="0" Spacing="3">
                        <Label Text="{Binding ExerciseName}"
                           Style="{StaticResource LabelBody}"
                           FontAttributes="Bold"/>
                        <Label Text="{Binding ApproachesText}"
                           Style="{StaticResource LabelCaption}"/>
                    </VerticalStackLayout>

                    <Grid Grid.Column="1" 
                          ColumnDefinitions="Auto, *, Auto" 
                          Margin="10,0">
                        <Button Grid.Column="0"
                                Text="—"
                                Style="{StaticResource ButtonCounter}"
                                BackgroundColor="{StaticResource BackgroundTertiary}"
                                Command="{Binding DecreaseApproachesCommand}"/>
                        <Label Grid.Column="1"
                               Text="{Binding Approaches}"
                               Style="{StaticResource LabelHeading}"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               Margin="5,0"/>
                        <Button Grid.Column="2"
                                Text="+"
                                Style="{StaticResource ButtonCounter}"
                                BackgroundColor="{StaticResource BackgroundTertiary}"
                                Command="{Binding IncreaseApproachesCommand}"/>
                    </Grid>

                    <Button Grid.Column="2"
                            Text="×"
                            BackgroundColor="{StaticResource TransparentColor}"
                            TextColor="{StaticResource AccentError}"
                            FontSize="20"
                            WidthRequest="30"
                            HeightRequest="30"
                            Padding="0"
                            BorderWidth="0"
                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AddProgramViewModel}}, Path=RemoveExerciseCommand}"
                            CommandParameter="{Binding .}"/>
                </Grid>
            </Frame>
        </DataTemplate>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, *, Auto" RowSpacing="0">

        <Grid Grid.Row="0"
              ColumnDefinitions="Auto, *, Auto"
              Padding="15,10"
              BackgroundColor="{StaticResource BackgroundTertiary}">

            <Button Grid.Column="0"
                    Command="{Binding CloseCommand}"
                    Style="{StaticResource ButtonClose}"/>

            <VerticalStackLayout Grid.Column="1"
                                 HorizontalOptions="Center"
                                 Spacing="{StaticResource SpacingXSmall}">
                <Label Text="{Binding Title}"
                       Style="{StaticResource LabelBody}"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>

            <BoxView Grid.Column="2"
                     HeightRequest="40"
                     WidthRequest="40"
                     Color="{StaticResource TransparentColor}"/>
        </Grid>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="{StaticResource SpacingLarge}"
                                 Spacing="{StaticResource SpacingLarge}"
                                 VerticalOptions="Start">

                <Frame Style="{StaticResource FrameCard}">
                    <VerticalStackLayout Spacing="{StaticResource SpacingXSmall}">
                        <Label Text="Название программы"
                               Style="{StaticResource LabelCaption}"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"/>
                        <Entry Text="{Binding ProgramName}"
                               Placeholder="Введите название"
                               Style="{StaticResource EntryDefault}"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Style="{StaticResource FrameCard}">
                    <VerticalStackLayout Spacing="{StaticResource SpacingSmall}">
                        <Label Text="Упражнения в программе"
                               Style="{StaticResource LabelCaption}"/>

                        <Button Text="+ Добавить упражнение"
                                Style="{StaticResource ButtonSecondary}"
                                HeightRequest="40"
                                Command="{Binding AddExerciseCommand}"/>

                        <CollectionView ItemsSource="{Binding ProgramExercises}"
                                        ItemTemplate="{StaticResource ProgramExerciseTemplate}"
                                        IsVisible="{Binding HasExercises}"
                                        SelectionMode="None"/>

                        <VerticalStackLayout IsVisible="{Binding HasNoExercises}"
                                             VerticalOptions="Center"
                                             HorizontalOptions="Center"
                                             Spacing="{StaticResource SpacingXSmall}"
                                             Margin="0,10">
                            <Label Text="Нет упражнений"
                                   Style="{StaticResource LabelCaption}"
                                   HorizontalOptions="Center"/>
                            <Label Text="Добавьте упражнения в программу"
                                   Style="{StaticResource LabelSubtle}"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>

        <Grid Grid.Row="2"
              Padding="15,20,15,30"
              BackgroundColor="{StaticResource BackgroundTertiary}">
            <Button Command="{Binding SaveCommand}"
                    Text="Сохранить"
                    Style="{StaticResource ButtonPrimary}"/>
        </Grid>
    </Grid>

</ContentPage>
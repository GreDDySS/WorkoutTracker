<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkoutTracker.ViewModels"
             xmlns:models="clr-namespace:WorkoutTracker.Models"
             x:Class="WorkoutTracker.Views.AddProgramPageView"
             x:DataType="vm:AddProgramViewModel"
             Title="Добавить программу"
             BackgroundColor="{StaticResource BackgroundPrimary}">

    <ContentPage.Resources>
        <DataTemplate x:Key="ProgramExerciseTemplate" x:DataType="models:ProgramExerciseItem">
            <Border Style="{StaticResource CardStyle}" Padding="15" Margin="0,0,0,10">
                <Grid ColumnDefinitions="*, Auto, Auto">
                    <VerticalStackLayout Grid.Column="0" Spacing="4" VerticalOptions="Center">
                        <Label Text="{Binding ExerciseName}" Style="{StaticResource LabelBody}" FontAttributes="Bold"/>
                        <Label Text="{Binding ApproachesText}" Style="{StaticResource LabelCaption}"/>
                    </VerticalStackLayout>

                    <Grid Grid.Column="1" ColumnDefinitions="Auto, 30, Auto" Margin="10,0" VerticalOptions="Center">
                        <Button Grid.Column="0" Text="-" Style="{StaticResource ButtonCounter}" 
                                WidthRequest="36" HeightRequest="36" CornerRadius="12" FontSize="16"
                                Command="{Binding DecreaseApproachesCommand}"/>

                        <Label Grid.Column="1" Text="{Binding Approaches}" Style="{StaticResource LabelBody}"
                               FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center"/>

                        <Button Grid.Column="2" Text="+" Style="{StaticResource ButtonCounter}"
                                WidthRequest="36" HeightRequest="36" CornerRadius="12" FontSize="16"
                                Command="{Binding IncreaseApproachesCommand}"/>
                    </Grid>

                    <Button Grid.Column="2" Text="✕"
                            BackgroundColor="Transparent" TextColor="{StaticResource AccentError}"
                            WidthRequest="40" HeightRequest="40" Padding="0" Margin="5,0,0,0"
                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AddProgramViewModel}}, Path=RemoveExerciseCommand}"
                            CommandParameter="{Binding .}"/>
                </Grid>
            </Border>
        </DataTemplate>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto, *, Auto" RowSpacing="0">

        <Grid Grid.Row="0" ColumnDefinitions="Auto, *, 40" Padding="20,15">
            <Button Grid.Column="0" Command="{Binding CloseCommand}" Style="{StaticResource ButtonClose}"/>
            <Label Grid.Column="1" Text="{Binding Title}" Style="{StaticResource LabelTitle}" FontSize="18" HorizontalOptions="Center" VerticalOptions="Center"/>
        </Grid>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="24" Spacing="24">

                <VerticalStackLayout Spacing="8">
                    <Label Text="НАЗВАНИЕ" Style="{StaticResource LabelCaption}"/>
                    <Border Stroke="{StaticResource BackgroundInput}" StrokeThickness="1" StrokeShape="RoundRectangle 16" BackgroundColor="{StaticResource BackgroundSecondary}" Padding="15,5">
                        <Entry Text="{Binding ProgramName}" Placeholder="Например: День ног" Style="{StaticResource EntryDefault}"/>
                    </Border>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="15">
                    <Grid ColumnDefinitions="*, Auto">
                        <Label Text="УПРАЖНЕНИЯ" Style="{StaticResource LabelCaption}" VerticalOptions="Center"/>
                        <Button Grid.Column="1" Text="+ Добавить" 
                                TextColor="{StaticResource AccentMain}" BackgroundColor="Transparent"
                                HeightRequest="40" Padding="0" FontAttributes="Bold" FontSize="14"
                                Command="{Binding AddExerciseCommand}"/>
                    </Grid>

                    <CollectionView ItemsSource="{Binding ProgramExercises}"
                                    ItemTemplate="{StaticResource ProgramExerciseTemplate}"
                                    IsVisible="{Binding HasExercises}"
                                    SelectionMode="None"/>

                    <Border IsVisible="{Binding HasNoExercises}" StrokeDashArray="5,5" Stroke="{StaticResource TextTertiary}" BackgroundColor="Transparent" StrokeShape="RoundRectangle 16" Padding="40" Margin="0,10">
                        <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                            <Label Text="Список пуст" Style="{StaticResource LabelBody}" TextColor="{StaticResource TextTertiary}" HorizontalOptions="Center"/>
                            <Label Text="Добавьте первое упражнение" Style="{StaticResource LabelCaption}" HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <Grid Grid.Row="2" Padding="24,20,24,30" BackgroundColor="{StaticResource BackgroundPrimary}">
            <Button Command="{Binding SaveCommand}"
                    Text="СОХРАНИТЬ ПРОГРАММУ"
                    Style="{StaticResource ButtonPrimary}"/>
        </Grid>
    </Grid>
</ContentPage>